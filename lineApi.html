<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE API</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .show{
            width:30%;
        }
    </style>
</head>
<body>
    <h1>LINE API</h1>
    <button type="button" id="generate">Generate data</button>
    <div id="output" ></div>

    <script>
            var Client_ID = '1654645518';
            var Client_secret = '654de9204e47f9442567599eaf721ff0';
            var code = '1Jyj6DluPDPvdbxs80oO';
            var redirect_uri = 'https%3A%2F%2Ffatmab2809.github.io%2FDemo1%2F';
            var grant_type = 'authorization_code';
            var access_token = 'eyJhbGciOiJIUzI1NiJ9.16SWEDOu7A4V-xLAcyOK4WPI4c8_hXIv66ZUZrK7vQhwEXedRN8PkaaRgsZxOsPdP1vNg4W27KRk3nrsI0HMIyQnu7uYs9dXFOcV9gVhhbK3HFUfvhKni-7o1l29cdc6DdTII6dN-LZLseSwyJUpXI-3XcuuAhYY8H-i4vtNSpk.4chO4Gzey6v2DnJvpC_oA2u6OeSD1kAjTkql6yFtces';
            document.getElementById('generate').addEventListener('click',generate);

        async function generate(e){
           e.preventDefault();

            //refresh access token    
            await fetch('https://api.line.me/oauth2/v2.1/token',{
                method:'POST',
                headers:{
                    'Content-Type':' application/x-www-form-urlencoded'
                },
                body:JSON.stringify( {
                    grant_type : 'refresh_token',
                    refresh_token:'2PZUexgrC02XNp4OxMbS',
                    client_id : Client_ID,
                    client_secret : Client_secret
                })
            })
            .then((res) => res.json())          //convert response to promise by using .json()
            .then((data) => {
                console.log(data);
                // access_token = data.access_token;
            })
            .catch((err) => console.log(err));

            //fetch user profile data
            // console.log('User Profile');
            let promise = fetchdata(Client_ID,Client_secret,code,redirect_uri,grant_type,access_token);
        }
    
        async function fetchdata(Client_ID,Client_secret,code,redirect_uri,grant_type,access_token){
           await fetch('https://api.line.me/v2/profile',{
                method: 'GET',
                headers: {
                    'Content-Type' : 'application/json',
                    'Authorization': 'Bearer '+ access_token
                }
            })
            .then((res) => res.json())
            .then((data) => {
                var output = `<p>User Name- ${data.displayName} </p><br>
                                <p>User Id- ${data.userId}</p><br>`;
                if(data.statusMessage){
                    output +=`<p>Status Message- ${data.statusMessage}</p>`;
                }
                document.getElementById('output').innerHTML += output;
                let imgurl = data.pictureUrl;
                if(imgurl){
                    let Img = document.createElement('img');
                    Img.setAttribute('src',`${imgurl}`);
                    Img.classList.add('.show');
                    document.querySelector('#output').appendChild(Img);
               
                }
                
                })
                
            .catch((err) => console.log(err));
           
        }
        
    </script>
</body>
</html>